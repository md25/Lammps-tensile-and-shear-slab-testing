clear
units metal
atom_style atomic
boundary p p p
read_data gamma_tial.data
replicate 10 10 10
pair_style meam
pair_coeff * * kim_library.meam Al Ti kim_AlTi.meam Al Ti
neighbor 2.0 bin
neigh_modify every 1 delay 0 check yes
thermo 100
thermo_style custom step pe pxx pyy pzz pxy pxz pyz press
fix 1 all box/relax aniso 0.0
minimize 1.0e-50 1.0e-50 10000 100000
unfix 1

variable Lxx0 equal "lx"
variable Lyy0 equal "ly"
variable Lzz0 equal "lz"
variable Lxy0 equal "xy"
variable Lxz0 equal "xz"
variable Lyz0 equal "yz"


variable GPa equal 10000 
min_style cg
min_modify dmax 0.1
# For C44, apply shear strain YZ (epsilon_4) and measure shear stress YZ (sigma_4)
variable p_current equal pyz


print "C44 calc"

variable delta equal 0.0001
variable delta2 equal "v_delta * 1.0" 

# Calculate yz tilt displacement (dist = strain * Lz)
variable d_dist equal "v_delta * v_Lzz0"
# Apply positive strain
change_box all triclinic yz delta ${d_dist} remap
minimize 1.0e-50 1.0e-50 5000 50000
variable p1_p equal ${p_current}
# Reset box
change_box all triclinic x final 0 ${Lxx0} y final 0 ${Lyy0} z final 0 ${Lzz0} xy final ${Lxy0} xz final ${Lxz0} yz final ${Lyz0} remap
# Calculate yz tilt displacement for negative strain
variable d_dist equal "-v_delta * v_Lzz0"
# Apply strain. Value aint positive. Too lazy!!
change_box all triclinic yz delta ${d_dist} remap
minimize 1.0e-50 1.0e-50 5000 50000
variable p1_n equal ${p_current}
# Reset box
change_box all triclinic x final 0 ${Lxx0} y final 0 ${Lyy0} z final 0 ${Lzz0} xy final ${Lxy0} xz final ${Lxz0} yz final ${Lyz0} remap

variable C44 equal "(v_p1_p - v_p1_n) / v_delta2 / v_GPa"
print "--- RESULT for delta = ${delta}: C44 = ${C44} GPa ---"
